<template name="header">
  <nav class="top-bar hide-until-rendered">
    <ul class="title-area">
      <!-- Title Area -->
      <li class="name">
        <h1 class="nav-title"><a href="/">{{#ifSetting 'logoUrl'}}<img class="logo" src="{{getSetting 'logoUrl'}}">{{/ifSetting}}{{getSetting 'siteName'}}</a></h1>
      </li>
      <li class="toggle-topbar menu-icon"><a href="#"><span>Menu</span></a></li>
    </ul>
    <section class="top-bar-section">
      <!-- Right Nav Section -->
      {{#ifAuthorOrAdmin}}
        <ul class="right">
          <li class="has-dropdown not-click">
            <a href="#"><i class="icon-cogs"></i><span class="show-for-small">Admin</span> <b class="caret"></b></a>
            <ul id="adminMenu" class="dropdown">
              <li><label>Admin</label></li>
              {{#if isInRole 'admin'}}
                <li><a href="/site_settings">Site Settings</a></li>
                <li><a href="/navigation">Site Navigation</a></li>
                <li><a href="/users">Users</a></li>
              {{/if}}
              <li><a href="/assets">Asset Library</a></li>
              <li><a href="/new_page">New Page</a></li>
              <li class="has-dropdown not-click">
                <a href="#">Edit Page</a>
                <ul class="dropdown">
                  {{#each pages}}
                    <li><a href="/{{slug}}/edit">{{title}}</a></li>
                  {{/each}}
                </ul>
              </li>
            </ul>
          </li>
        </ul>
      {{/ifAuthorOrAdmin}}
      {{#ifSetting 'showLoginInHeader'}}
        <ul class="right">
          <li class=""><a href="/login"><i class="icon-user{{#if signedInAs}} logged-in{{/if}}"></i><span class="show-for-small">Login / Logout</span></a></li>
        </ul>
      {{/ifSetting}}
      {{#isolate}}
        {{#with headerNav}}
          {{>header_nav_root}}
        {{/with}}
      {{/isolate}}
    </section>
  </nav>
</template>

<template name="header_nav_root">
  <ul class="left">
    {{#each this}}
      {{#if children}}
        <li class="has-dropdown">
          <a href="{{url}}" data-toggle="dropdown">{{title}}<b class="caret"></b></a>
          {{>header_nav_child}}
        </li>
      {{else}}
        <li>
          <a href="{{url}}">{{title}}</a>
        </li>
      {{/if}}
    {{/each}}
  </ul>
</template>

<template name="header_nav_child">
  <ul class="dropdown">
    {{#each children}}
      {{#if children}}
        <li class="has-dropdown">
          <a href="{{url}}">{{title}}<b class="caret"></b></a>
          {{>header_nav_child}}
        </li>
      {{else}}
        <li>
          <a href="{{url}}">{{title}}</a>
        </li>
      {{/if}}
    {{/each}}
  </ul>
</template>